<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ locale_data.changelog.meta.title }}</title>
    <meta name="description" content="{{ locale_data.changelog.meta.description }}" />
    {% if page_number == 1 %}
    <link rel="canonical" href="{{ locale_data.changelog.meta.canonical_url }}" />
    {% else %}
    <link rel="canonical" href="{{ locale_data.changelog.meta.canonical_url }}page-{{ page_number }}/" />
    {% endif %}
    {% for link in hreflang_links %}
    <link rel="alternate" hreflang="{{ link.hreflang }}" href="{{ link.href }}">
    {% endfor %}
    <link rel="alternate" type="application/rss+xml" title="{{ locale_data.changelog.meta.title }}" href="/lib/rss/{{ lang }}/feed.xml">

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ locale_data.changelog.meta.title }}" />
    <meta property="og:description" content="{{ locale_data.changelog.meta.description }}" />
    {% if page_number == 1 %}
    <meta property="og:url" content="{{ locale_data.changelog.meta.canonical_url }}" />
    {% else %}
    <meta property="og:url" content="{{ locale_data.changelog.meta.canonical_url }}page-{{ page_number }}/" />
    {% endif %}
    <meta property="og:site_name" content="Frames" />
    <meta property="og:image" content="https://withframes.com/og-image.jpg" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ locale_data.changelog.meta.title }}" />
    <meta name="twitter:description" content="{{ locale_data.changelog.meta.description }}" />
    <meta name="twitter:image" content="https://withframes.com/og-image.jpg" />

    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <style>
      {{ changelog_css | safe }}
    </style>
  </head>
  <body>

    <header class="main-header wrapper">
        <div class="container-header grid">
            <a href="{{ lang_config.path }}" class="logo leading" aria-label="{{ locale_data.header.logo_aria_label }}">
                {{ locale_data.header.logo_text }}
            </a>

            <nav class="navigation center" aria-label="{{ locale_data.header.navigation.aria_label }}">
                <ul class="flex flex-row">
                    <li class="desktop-only"><a href="{{ locale_data.meta.canonical_url }}#features">{{ locale_data.header.navigation.features }}</a></li>
                    <li><a class="tooltip" data-tooltip="{{ locale_data.tooltip.label_coming_soon }}">{{ locale_data.header.navigation.documentation }}</a></li>
                    <li><a aria-current="page" href="{{ lang_config.path }}{{ locale_data.urls.changelog }}">{{ locale_data.header.navigation.changelog }}</a></li>
                </ul>
            </nav>

            <div class="trailing flex flex-row flex-center gap-sm">
                <button class="btn btn-sm btn-dark mobile-hidden" id="button-social-share"
                    aria-controls="overlay" aria-expanded="false">
                    <span>{{ locale_data.header.buttons.share }}</span>
                </button>
                <a href="{{ locale_data.urls.appstore_macos }}" class="btn btn-sm btn-light desktop-up">{{ locale_data.header.buttons.download }}</a>
                <a href="{{ locale_data.urls.appstore_ios }}" class="btn btn-sm btn-light tablet-only">{{ locale_data.header.buttons.download }}</a>
                <a href="{{ locale_data.urls.appstore_ios }}" class="btn btn-sm btn-dark desktop-hidden">{{ locale_data.header.buttons.download }}</a>
                
                <button id="menu-toggle" class="mobile-menu-toggle"
                    aria-label="{{ locale_data.mobile_menu.open_aria_label }}"
                    aria-controls="overlay"
                    aria-expanded="false">
                    <img src="/lib/img/icn/menu.svg" alt="Menu Icon" width="32" height="32" loading="lazy" aria-hidden="true">
                </button>
            </div>
        </div>
    </header>

    <main class="changelog wrapper">
      <header class="changelog-header grid grid-4col">
        <div class="col-start-2 col-span-2">
          <h1><a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}">{{ locale_data.changelog.heading }}</a></h1>
        </div>
      </header>

      {% for entry in entries %}
      <article class="grid grid-4col" itemscope itemtype="https://schema.org/BlogPosting">
        <link itemprop="url" href="https://withframes.com/changelog/{{ entry.url_slug }}/" />
        <div class="release-info">
          <div class="release-info-inner flex flex-center flex-justify-start gap-sm">

          <a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}{{ entry.url_slug }}/" class="flex flex-center flex-justify-start gap-sm">
            <span class="release-number">{{ locale_data.changelog.labels['platform_' + entry.platform] }} {{ entry.version_short }}</span>
            <time datetime="{{ entry.release_date }}" class="release-datetime">{{ entry.formatted_date }}</time>
          </a>

          {% if loop.first %}
          <span class="changelog-dot">·</span>
          <a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}" class="release-page-title">
            <span>{{ locale_data.changelog.heading }}</span>
          </a>
          {% endif %}
          </div>
        </div>

        <div class="changelog-article-main col-span-2">
          <h2 class="h1" itemprop="headline"><a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}{{ entry.url_slug }}/">{{ entry.title }}</a></h2>
          <p itemprop="description">{{ entry.summary }}</p>
          <meta itemprop="datePublished" content="{{ entry.release_date }}" />
          {% if entry.og_image_url and entry.og_image_url != '/og-image.jpg' %}
          <link itemprop="image" href="https://withframes.com{{ entry.og_image_url }}" />
          <meta itemprop="width" content="1200" />
          <meta itemprop="height" content="630" />
          {% endif %}

          {% for section in entry.sections %}
          {% if section.type == 'heading' %}
          <h{{ section.level }}>{{ section.content }}</h{{ section.level }}>
          {% elif section.type == 'paragraph' %}
          <p>
            {{ section.content }}
            {% if section.link %}
            <a href="{{ section.link.url }}">{{ section.link.text }}</a>
            {% endif %}
          </p>
          {% elif section.type == 'list' %}
          <ul>
            {% for item in section['items'] %}
            <li>
              <div class="bullet-point">
                {% if item.title %}<strong>{{ item.title }}</strong>: {% endif %}{{ item.description }}
              </div>
            </li>
            {% endfor %}
          </ul>
          {% elif section.type == 'media' %}
          <div class="changelog-media">
            <figure class="tile container-ratio ratio-4-3">
                <div class="tile-inner">
                    <img src="{{ section.image }}"
                        srcset="{{ section.image }} 1x, {{ section.image_2x }} 2x"
                        alt="{{ section.alt }}"
                        width="{{ section.width }}" height="{{ section.height }}" loading="lazy">
                </div>
            </figure>
          </div>
          {% endif %}
          {% endfor %}

          <div class="changelog-details flex flex-col">
            {% if entry.improvements %}
            <details>
                    <summary class="flex flex-justify-between flex-center">
                        <h3>{{ locale_data.changelog.labels.improvements }} ({{ entry.improvements|length }})</h3>
                    </summary>
                    <ul>
                      {% for improvement in entry.improvements %}
                      <li>
                        <div class="bullet-point">
                          {{ improvement }}
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                </details>
            {% endif %}

            {% if entry.fixes %}
            <details>
                    <summary class="flex flex-justify-between flex-center">
                        <h3>{{ locale_data.changelog.labels.fixes }} ({{ entry.fixes|length }})</h3>
                    </summary>
                    <ul>
                      {% for fix in entry.fixes %}
                      <li>
                        <div class="bullet-point">
                          {% if fix is string %}
                          {{ fix }}
                          {% else %}
                          <strong>{{ fix.title }}</strong>: {{ fix.description }}
                          {% endif %}
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                </details>
            {% endif %}

            {% if entry.patches %}
            <details>
                    <summary class="flex flex-justify-between flex-center">
                        <h3>{{ locale_data.changelog.labels.patches }} ({{ entry.patches|length }})</h3>
                    </summary>
                    <ul>
                      {% for patch in entry.patches %}
                      <li>
                        <div class="bullet-point">
                          <span>{{ patch.version }}</span><span>:</span> <span>{{ patch.description }}</span>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                </details>
            {% endif %}
          </div>
        </div>
      </article>

      {% if not loop.last %}
      <hr class="changelog-divider">
      {% endif %}
      {% endfor %}

      {% if total_pages > 1 %}
      <nav class="pagination grid grid-4col" aria-label="Changelog pagination">
        <div></div>
        <div class="pagination-inner col-span-2 flex gap-sm2">
          {% if page_number > 1 %}
          <div class="pagination-prev col-start-2 tile">
            {% if page_number == 2 %}
            <a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}" class="tile-inner">
              <span class="pagination-label">← {{ locale_data.changelog.pagination.previous }}</span>
              <span class="pagination-title">{{ locale_data.changelog.pagination.newer_posts }}</span>
            </a>
            {% else %}
            <a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}page-{{ page_number - 1 }}/" class="tile-inner">
              <span class="pagination-label">← {{ locale_data.changelog.pagination.previous }}</span>
              <span class="pagination-title">{{ locale_data.changelog.pagination.newer_posts }}</span>
            </a>
            {% endif %}
          </div>
          {% endif %}

          {% if page_number < total_pages %}
          <div class="pagination-next tile">
            <a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}page-{{ page_number + 1 }}/" class="tile-inner">
              <span class="pagination-label">{{ locale_data.changelog.pagination.next }} →</span>
              <span class="pagination-title">{{ locale_data.changelog.pagination.older_posts }}</span>
            </a>
          </div>
          {% endif %}
        </div>
      </nav>
      {% endif %}
    </main>

    <aside class="wrapper">
        <section class="contact tile container-ratio ratio-2-1" aria-labelledby="contact-heading">
            <div class="contact-inner flex flex-col flex-center flex-justify-center">
                <h2 id="contact-heading">{{ locale_data.contact.heading }}</h2>
                <a href="mailto:&#104;&#105;&#64;&#119;&#105;&#116;&#104;&#102;&#114;&#97;&#109;&#101;&#115;&#46;&#99;&#111;&#109;" class="btn btn-md btn-secondary">{{ locale_data.contact.button_text }}</a>
            </div>
        </section>
    </aside>

    <footer class="main-footer wrapper flex flex-col gap-6xl">
        <div class="footer-links grid grid-4col">
            <a href="{{ lang_config.path }}" aria-label="{{ locale_data.header.logo_aria_label }}" class="w-fit">
                <img src="/lib/img/logo/frames.svg" alt="{{ locale_data.footer.logo_alt }}" width="40" height="40">
            </a>
            <ul class="flex flex-col gap-sm2">
                <li><h3>{{ locale_data.footer.connect.heading }}</h3></li>
                <li><a href="https://www.instagram.com/with_frames/" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.connect.instagram }}</a></li>
                <li><a href="https://www.threads.net/@with_frames" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.connect.threads }}</a></li>
                <li><a href="https://www.facebook.com/framesapp" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.connect.facebook }}</a></li>
                <li><a href="https://bsky.app/profile/withframes.bsky.social" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.connect.bluesky }}</a></li>
                <li><a href="https://mastodon.social/@frames" target="_blank" rel="me noopener noreferrer">{{ locale_data.footer.connect.mastodon }}</a></li>
                <li><a href="https://twitter.com/withframes" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.connect.twitter }}</a></li>
            </ul>
            <ul class="flex flex-col gap-sm2">
                <li><h3>{{ locale_data.footer.resources.heading }}</h3></li>
                <li><a href="{{ lang_config.path }}{{ locale_data.urls.privacy }}">{{ locale_data.footer.resources.privacy_policy }}</a></li>
                <li><a href="https://www.apple.com/legal/internet-services/itunes/dev/stdeula/" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.resources.terms_of_service }}</a></li>
                <li><a class="tooltip" data-tooltip="{{ locale_data.tooltip.label_coming_soon }}">{{ locale_data.footer.resources.documentation }}</a></li>
                <li><a href="{{ lang_config.path }}{{ locale_data.urls.changelog }}">{{ locale_data.footer.resources.changelog }}</a></li>
                <li><a href="https://www.youtube.com/@withframes" target="_blank" rel="noopener noreferrer">{{ locale_data.footer.resources.youtube }}</a></li>
            </ul>
            <ul class="flex flex-col gap-sm2">
                <li><h3>{{ locale_data.footer.product.heading }}</h3></li>
                <li><a href="{{ locale_data.urls.appstore_ios }}">{{ locale_data.footer.product.frames_ios }}</a></li>
                <li><a href="{{ locale_data.urls.appstore_macos }}">{{ locale_data.footer.product.frames_macos }}</a></li>
            </ul>
        </div>

        <div class="footer-bottom flex flex-row flex-justify-between flex-center">
            <div class="flex flex-center flex-justify-center gap-lg">
                <p>© 2025 <a href="https://vnn.io/" rel="noopener noreferrer author" target="_blank">Vincent Tantardini</a>.</p>
                {% if locale_data.footer.compliance %}
                <p class="flex flex-center flex-justify-center mobile-hidden">
                    <img src="/lib/img/icn/checkmark-shield.svg" width="14" height="14" alt="" loading="lazy" aria-hidden="true" class="compliance-icon">
                    {{ locale_data.footer.compliance }}
                </p>
                {% endif %}
            </div>

                <div class="dropdown">
                    <input type="checkbox" class="dropdown-toggle" id="lang-toggle">

                    <label for="lang-toggle" class="dropdown-button btn btn-sm btn-dark">
                        <img src="/lib/img/icn/globe.svg" alt="Globe Icon" loading="lazy">
                        <span>{{ locale_data.footer.language_dropdown.label }}</span>
                        <img src="/lib/img/icn/chevron-down-sm.svg" alt="Chevron Down" width="10" height="12" loading="lazy">
                    </label>

                    <ul class="dropdown-content dropdown-dir-top" role="menu">
                        {% for language in all_languages %}
                        <li>
                            <a role="menuitem" href="{% if language.code in available_changelog_languages %}{{ language.url }}changelog/{% if page_number > 1 %}page-{{ page_number }}/{% endif %}{% else %}/changelog/{% if page_number > 1 %}page-{{ page_number }}/{% endif %}{% endif %}">
                                <span>{{ language.name }}</span>
                                {% if language.code == lang %}
                                <span>✓</span>
                                {% endif %}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
        </div>
    </footer>

    <!-- Main Overlay -->
    <div class="overlay flex flex-center flex-justify-center" id="overlay" role="dialog"
        aria-modal="true" aria-labelledby="" hidden>
        <div class="modal" id="modal-container"></div>
    </div>

    {% if lang == 'en' %}
    <script defer src="/lib/js/changelog/core.js"></script>
    {% else %}
    <script defer src="/lib/js/{{ lang }}/changelog/core.js"></script>
    {% endif %}
  </body>
</html>
